<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>waterfall</title>
  <script src="../source/jquery-3.2.1.js"></script>
  <script>
    $(document).ready(function () {
      $(window).on("load", function () {
       var dataImg = {"data":[{"src":"pb1.jpg"},{"src":"pb2.jpg"},{"src":"pb3.jpg"},{"src":"pb4.jpg"},{"src":"pb5.jpg"},{"src":"pb6.jpg"},{"src":"pb7.jpg"},{"src":"pb8.jpg"}]};
        imglocation();
        window.onscroll = function(){
          if(scrollside()){
            $.each(dataImg.data,function(index,value){
              var box = $("<div>").addClass("box").appendTo($("#container"));
              var content = $("<div>").addClass("content").appendTo(box);
              $("<img>").attr("src","images/"+$(value).attr("src")).appendTo(content);
            });
            imglocation();
          }
        };
      });
    });

    function scrollside(){
      var box = $(".box");
      var lastboxHeight = box.last().get(0).offsetTop + Math.floor(box.last().height()/2);
      var documentHeight = $(document).width();
      var scrollHeight = $(window).scrollTop();
      return (lastboxHeight<scrollHeight+documentHeight)?true:false;
    }
    function imglocation() {
      var box = $(".box");
      var boxWidth = box.eq(0).width();
      var num = Math.floor($(window).width() / boxWidth);
      var boxArr = [];
      box.each(function (index, value) {
        var boxHeight = box.eq(index).height();
        if (index < num) {
          boxArr[index] = boxHeight;
        } else {
          var minboxHeight = Math.min.apply(null, boxArr);
          var minboxIndex = $.inArray(minboxHeight, boxArr);
          $(value).css({
            "position": "absolute",
            "top": minboxHeight,
            "left": box.eq(minboxIndex).position().left
          });
          boxArr[minboxIndex] += box.eq(index).height();
        }
      })
    }

  </script>
  <style>
        * {
          margin: 0;
          padding: 0;
        }

        .box {
          width: 315px;
          padding: 5px;
          border: 1px solid #cccccc;
          float: left;
          box-shadow: 0px 0px 5px #ccc;
          border-radius: 5px;
          margin: 4px;
        }

        img {
          width: 290px;
        }
      </style>
    </head>
    <body>
    <div id="container">
          <div class="box">
                <div class="content">
                  <img src="images/pb1.jpg" alt=""/>
                </div>
          </div>
          <div class="box">
                <div class="content">
                  <img src="images/pb2.jpg" alt=""/>
                </div>
          </div>
          <div class="box">
                <div class="content">
                  <img src="images/pb3.jpg" alt=""/>
                </div>
          </div>
          <div class="box">
                <div class="content">
                  <img src="images/pb4.jpg" alt=""/>
                </div>
          </div>
          <div class="box">
                <div class="content">
                  <img src="images/pb5.jpg" alt=""/>
                </div>
          </div>
          <div class="box">
                <div class="content">
                  <img src="images/pb6.jpg" alt=""/>
                </div>
          </div>
          <div class="box">
                <div class="content">
                  <img src="images/pb7.jpg" alt=""/>
                </div>
          </div>
          <div class="box">
                <div class="content">
                  <img src="images/pb8.jpg" alt=""/>
                </div>
          </div>
          <div class="box">
                <div class="content">
                  <img src="images/pb9.jpg" alt=""/>
                </div>
          </div>
          <div class="box">
                <div class="content">
                  <img src="images/pb10.jpg" alt=""/>
                </div>
          </div>
      </div>
</body>
</html>